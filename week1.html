<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 1: Advanced Tractor-Implement Systems</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f4; 
            color: #44403c; 
        }
        .nav-btn {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 600;
            color: #57534e;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            border-left: 4px solid transparent;
        }
        .nav-btn:hover {
            background-color: #e7e5e4;
            color: #1c1917;
        }
        .nav-btn.active {
            background-color: #fef3c7; 
            color: #92400e; 
            border-left-color: #d97706; 
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        .content-section {
            display: none; 
        }
        .content-section.active {
            display: block;
        }
        .tab-btn {
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #78716c;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        .tab-btn:hover {
            color: #1c1917;
        }
        .tab-btn.active {
            color: #d97706; 
            border-bottom-color: #d97706;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        .diagram {
            border: 2px solid #d6d3d1;
            background-color: #fafaf9;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
        }
        .diagram-box {
            border: 2px solid #44403c;
            background: #fff;
            padding: 1rem;
            width: 120px;
            margin: 0.5rem auto;
            font-weight: 600;
        }
        .diagram-arrow {
            font-size: 1.5rem;
            font-weight: bold;
            color: #d97706;
        }

        /* --- CSS NEW/UPDATED for Problem Set and Accordion --- */
        .problem-content {
            display: none; /* Hide problem content by default */
        }
        .problem-content.active {
            display: block; /* Show active problem content */
        }
        .accordion-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 0.75rem 1rem;
            font-weight: 600;
            text-align: left;
            background-color: #fef3c7; /* Amber-100 */
            border: 1px solid #fde68a; /* Amber-200 */
            border-radius: 0.375rem;
            margin-top: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .accordion-toggle:hover {
            background-color: #fcd34d; /* Amber-300 */
        }
        .accordion-toggle .icon::after {
            content: '+';
            font-size: 1.25rem;
            transition: transform 0.2s;
        }
        .accordion-toggle.active .icon::after {
            content: '-';
        }
        .accordion-content {
            /* Key change: Hide content by default */
            display: none; 
            padding: 1rem;
            border-left: 3px solid #f59e0b; /* Amber-500 */
            background-color: #fff7ed; /* Orange-50 for subtle contrast */
            margin-top: 0.25rem;
            border-radius: 0 0 0.375rem 0.375rem;
        }
        .accordion-content.active {
            /* Key change: Show content when active */
            display: block; 
        }
        .fbd-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            padding: 2rem;
            background-color: #fefcfb;
            border: 1px solid #e7e5e4;
            border-radius: 0.5rem;
            min-height: 150px;
        }
        .fbd-box {
            border: 2px solid #92400e;
            background: #fff;
            padding: 0.5rem 1rem;
            font-weight: 600;
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .fbd-arrow {
            font-size: 0.9rem;
            font-weight: bold;
            color: #44403c;
            position: absolute;
        }

    </style>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
          // keep processing simple HTML (default)
        }
      };
    </script>
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body class="bg-stone-100">

    <main class="max-w-7xl mx-auto p-4 md:p-8">
        <header class="mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-stone-900">Week 1: Introduction to Advanced Tractor-Implement Systems</h1>
            <p class="text-xl text-stone-600 mt-2">An interactive guide to the 3-hour introductory session.</p>
        </header>

        <div class="md:flex md:space-x-8">
            
            <aside class="w-full md:w-1/4 lg:w-1/5 mb-6 md:mb-0">
                <nav class="sticky top-8 bg-white p-4 rounded-lg shadow-md">
                    <ul class="space-y-2">
                        <li><button class="nav-btn active" data-content="overview">Overview & Objectives</button></li>
                        <li><button class="nav-btn" data-content="systems">1. Key Tractor Subsystems</button></li>
                        <li><button class="nav-btn" data-content="implements">2. Implement Classification</button></li>
                        <li><button class="nav-btn" data-content="dynamics">3. Dynamic Principles</button></li>
                        <li><button class="nav-btn" data-content="summary">4. Summary & Tasks</button></li>
                        
                        <li><button class="nav-btn" data-content="problem">5. Interactive Problem Set</button></li>
                    </ul>
                </nav>
            </aside>

            <section id="content-panel" class="w-full md:w-3/4 lg:w-4/5">
                
                <div id="overview-content" class="content-section active space-y-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-amber-700 mb-4">Session Objectives</h2>
                        <p class="mb-4 text-stone-700">This module provides the foundation for the entire course. By the end of this session, you will be able to navigate the core concepts of advanced machinery analysis.</p>
                        <ul class="list-disc list-outside pl-5 space-y-2 text-stone-700">
                            <li><span class="font-semibold">Contextualize:</span> Differentiate advanced dynamic analysis from basic machine design.</li>
                            <li><span class="font-semibold">Analyze:</span> Break down the functional roles of key tractor subsystems (Power Train, Hydraulics, Chassis) and their impact on field performance.</li>
                            <li><span class="font-semibold">Classify:</span> Categorize agricultural implements by their hitching mechanism and understand the resulting dynamic effects.</li>
                            <li><span class="font-semibold">Formulate:</span> Create a simplified dynamic model by identifying the necessary Degrees of Freedom (DoF) for stability analysis.</li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-amber-700 mb-4">Session Time Allocation (180 min)</h2>
                        <p class="text-stone-700 text-center mb-4">The session is broken into three main parts, with the majority focused on foundational knowledge and analysis.</p>
                        <div class="chart-container">
                            <canvas id="timeChart"></canvas>
                        </div>
                    </div>
                </div>

                <div id="systems-content" class="content-section space-y-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-amber-700 mb-4">1. Key Tractor Subsystems Review</h2>
                        <p class="text-stone-700 mb-6">This section reviews the systems that provide the inputs and handle the outputs of the dynamic models we will study. Understanding their function is critical to analyzing performance.</p>
                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                            
                            <div class="border border-stone-200 p-4 rounded-lg bg-stone-50">
                                <h3 class="text-lg font-bold text-stone-800">A. Power Train</h3>
                                <p class="text-sm text-stone-600 mt-1"><span class="font-semibold">Function:</span> Delivers torque to the wheels. Transmission choice (CVT vs. Powershift) dictates the ability to maintain optimal engine speed for traction.</p>
                                <p class="text-sm text-stone-600 mt-2"><span class="font-semibold">Critical Parameters:</span> Engine Torque Curve, Transmission Efficiency.</p>
                            </div>
                            
                            <div class="border border-stone-200 p-4 rounded-lg bg-stone-50">
                                <h3 class="text-lg font-bold text-stone-800">B. Chassis & Ballasting</h3>
                                <p class="text-sm text-stone-600 mt-1"><span class="font-semibold">Function:</span> The structural frame and weight distribution. Ballasting (adding weight) optimizes the load ratio on drive wheels to maximize traction.</p>
                                <p class="text-sm text-stone-600 mt-2"><span class="font-semibold">Critical Parameters:</span> Center of Gravity (CG) location, Axle Load, Ballast Mass.</p>
                            </div>
                            
                            <div class="border border-stone-200 p-4 rounded-lg bg-stone-50">
                                <h3 class="text-lg font-bold text-stone-800">C. Hydraulics & Control</h3>
                                <p class="text-sm text-stone-600 mt-1"><span class="font-semibold">Function:</span> The core mechanism for implement interaction. Draft Control is a feedback system to stabilize load and prevent wheel slip.</p>
                                <p class="text-sm text-stone-600 mt-2"><span class="font-semibold">Critical Parameters:</span> Hydraulic response time, Draft sensing, Hitch geometry.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="implements-content" class="content-section space-y-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-amber-700 mb-2">2. Implement Classification by Hitching</h2>
                        <p class="text-stone-700 mb-6">The method of coupling is the most significant factor determining the dynamic equations of the combined tractor-implement system. Select a type to see its dynamic effect.</p>
                        
                        <nav class="flex border-b border-stone-300 mb-4" id="implement-tabs">
                            <button class="tab-btn active" data-tab="mounted">1. Mounted</button>
                            <button class="tab-btn" data-tab="semi-mounted">2. Semi-Mounted</button>
                            <button class="tab-btn" data-tab="trailed">3. Trailed (Towed)</button>
                        </nav>
                        
                        <div id="mounted" class="tab-content active p-4">
                            <h3 class="text-xl font-bold text-stone-800">Mounted Implements</h3>
                            <p class="text-stone-700 mt-2"><span class="font-semibold">Connection:</span> Fully supported by the 3-point hitch (3PH). The implement's mass is added directly to the tractor's mass.</p>
                            <p class="text-stone-700 mt-2"><span class="font-semibold">Primary Dynamic Effect:</span> Causes a major shift in the system's Center of Gravity (CG). Critically influences the <strong>Rearward Overturning</strong> moment, as all forces are transmitted through the hitch.</p>
                            <p class="text-stone-700 mt-2"><span class="font-semibold">Examples:</span> Plows, Rotary Tillers, Small Planters.</p>
                            
                           <p class="text-stone-700 mt-2"><span class="font-semibold">Axle Load Analysis:</span> The vertical force ($F_V$) is highly significant and variable, often including the entire implement weight. The effective point of action is $P(L_{fP}, h_P)$.
            </p>

            <h3 class="condition-header">A. Static Condition ($$a=0$$, $$F_{H}=0$$, $$W_{imp}$$ supported)</h3>
            <div class="text-center text-lg p-2 bg-green-100 rounded-md">
                $$N_r = \underbrace{\frac{M g L_f}{L}}_{\text{Tractor Static}} + \underbrace{W_{imp} \cdot \frac{L_{fi}}{L}}_{\text{Implement Static}}$$
            </div>
            <p class="mt-2 text-sm text-gray-600">
                The implement weight ($W_{imp}$) is distributed based on its CG position ($L_{fi}$ is distance from $W_{imp}$ CG to front axle).
            </p>

            <h3 class="condition-header mt-6">B. Dynamic Condition ($$a \ne 0$$, $$F_{H} \ne 0$$)</h3>
            <div class="text-center text-xl p-3 bg-green-200 rounded-md overflow-x-auto">
                $$N_r' = \underbrace{\frac{M g L_f}{L}}_{\text{Static Load}} + \underbrace{\frac{M a h_{CG}}{L}}_{\text{Acceleration Transfer}} + \underbrace{\frac{F_{H} h_{P} + F_{V} L_{fP}}{L}}_{\text{3PH Implement Transfer}}$$
            </div>
            <p class="mt-2 text-sm text-gray-600">
                The implement transfer term includes both horizontal ($F_H$) and vertical ($F_V$) forces, which are determined by the complex 3PH geometry and soil reactions.
            </p>
        </div>
                        </div>
                        
                        <div id="semi-mounted" class="tab-content p-4">
                            <h3 class="text-xl font-bold text-stone-800">Semi-Mounted Implements</h3>
                            <p class="text-stone-700 mt-2"><span class="font-semibold">Connection:</span> Connected to the 3PH at the front; supported by its own transport wheels at the rear.</p>
                            <p class="text-stone-700 mt-2"><span class="font-semibold">Primary Dynamic Effect:</span> Load is shared between the hitch and the implement's wheels. This creates a complex <strong>Pitch Moment</strong> interaction and a very long effective wheelbase.</p>
                            <p class="text-stone-700 mt-2"><span class="font-semibold">Examples:</span> Large Ripper Plows, Large Seed Drills.</p>
                        </div>
                        
                        <div id="trailed" class="tab-content p-4">
                            <h3 class="text-xl font-bold text-stone-800">Trailed (Towed) Implements</h3>
                            <p class="text-stone-700 mt-2"><span class="font-semibold">Connection:</span> Connected by a simple drawbar. The implement is fully supported by its own wheels.</p>
                            <p class="text-stone-700 mt-2"><span class="font-semibold">Primary Dynamic Effect:</span> Introduces significant <strong>Lateral Force</strong> and <strong>Yaw Moment</strong> during turns. This directly affects steering stability and can cause <strong>Drifting</strong>.</p>
                            <p class="text-stone-700 mt-2"><span class="font-semibold">Examples:</span> Trailers, Large Disks, Harvesters.</p>
                        </div>
                    </div>
                </div>

                <div id="dynamics-content" class="content-section space-y-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-amber-700 mb-4">3. Principles of Advanced Dynamic Analysis</h2>
                        <p class="text-stone-700 mb-6">This section bridges the mechanical review with the mathematical modeling. We move from static (stationary) analysis to dynamic (moving) analysis.</p>
                        
                        <h3 class="text-xl font-bold text-stone-800 mb-4">Static vs. Dynamic Stability</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="diagram">
                                <h4 class="font-semibold text-lg">Static Stability (At Rest)</h4>
                                <div class="diagram-box">Tractor</div>
                                <div class="diagram-arrow">↓ W (Weight)</div>
                                <div class="diagram-arrow">↑ N (Normal Force)</div>
                                <p class="mt-2 font-mono text-lg">ΣF = 0</p>
                                <p class="text-sm text-stone-600">Analyzes stability based on CG position relative to the wheelbase when stationary.</p>
                            </div>
                            <div class="diagram">
                                <h4 class="font-semibold text-lg">Dynamic Stability (Moving)</h4>
                                <div class="diagram-box">Tractor</div>
                                <div class="diagram-arrow">→ F (Thrust)</div>
                                <div class="diagram-arrow">← D (Drag)</div>
                                <p class="mt-2 font-mono text-lg">ΣF = m*a</p>
                                <p class="text-sm text-stone-600">Analyzes stability during acceleration, turning, or on a slope, including inertial forces.</p>
                            </div>
                        </div>

                        <h3 class="text-xl font-bold text-stone-800 mt-8 mb-4">Degrees of Freedom (DoF) & Simplified Models</h3>
                        <p class="text-stone-700 mb-4">A complete 3D analysis is too complex (12+ DoF). We simplify the problem by selecting only the *relevant* DoF for the specific analysis.</p>
                        
                        <div class="diagram p-4">
                            <h4 class="font-semibold text-lg mb-2">6-DoF of a Rigid Body (Tractor)</h4>
                            <div class="grid grid-cols-2 gap-4 text-left">
                                <div>
                                    <h5 class="font-semibold">Translational (Motion)</h5>
                                    <ul class="list-disc pl-5">
                                        <li>X (Surge - forward/back)</li>
                                        <li>Y (Sway - side to side)</li>
                                        <li>Z (Heave - up/down)</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="font-semibold">Rotational (Orientation)</h5>
                                    <ul class="list-disc pl-5">
                                        <li>φ (Roll - side tipping)</li>
                                        <li>θ (Pitch - front/back tipping)</li>
                                        <li>ψ (Yaw - turning left/right)</li>
                                    </ul>
                                </div>
                            </div>
                            <p class="text-sm text-stone-600 mt-4">For <strong>Rearward Overturning</strong>, we simplify to a 2-DoF model: Longitudinal position (X) and Pitch angle (θ).</p>
                        </div>
                    </div>
                </div>

                <div id="summary-content" class="content-section space-y-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-amber-700 mb-4">4. Summary & Next Steps</h2>
                        <h3 class="text-xl font-bold text-stone-800 mb-4">Key Takeaways</h3>
                        <ul class="list-disc list-outside pl-5 space-y-2 text-stone-700">
                            <li><span class="font-semibold">The Hitch is the Key:</span> The point of connection (3PH vs. Drawbar) defines the entire dynamic model.</li>
                            <li><span class="font-semibold">Dynamics over Statics:</span> Field performance and safety must be analyzed under dynamic loads (acceleration, turning).</li>
                            <li><span class="font-semibold">Simplify to Solve:</span> We use simplified DoF models to analyze specific failure modes (like overturning or drifting).</li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-amber-700 mb-4">Application Task: Static Review Problem</h2>
                        <p class="text-stone-700 mb-4">As preparation for next week, apply static principles to the following problem:</p>
                        <div class="bg-amber-50 border border-amber-200 p-4 rounded-lg">
                            <p class="font-medium text-stone-800">A 6,000 kg 4WD tractor has its Center of Gravity (CG) located 1.5 m forward of the rear axle and 1.0 m above the ground. The wheelbase is 3.0 m.</p>
                            <p class="text-stone-700 mt-4">**Calculate:**</p>
                            <ol class="list-decimal list-outside pl-5 mt-2 space-y-1">
                                <li>The static load on the front and rear axles when the tractor is at rest.</li>
                                <li>The new static axle loads if the tractor applies a horizontal draft force ($F_D = 40 \text{ kN}$) at $0.5 \text{ m}$ above the ground.</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <div id="problem-content" class="content-section space-y-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-amber-700 mb-4">5. Interactive Problem Set </h2>
                        <div class="md:flex md:space-x-8">
                            
                            <aside class="w-full md:w-1/3 lg:w-1/4 mb-6 md:mb-0">
                                <nav class="sticky top-8 bg-white p-4 rounded-lg shadow-md">
                                    <ul class="space-y-2" id="problem-nav">
                                        <li><button class="nav-btn active" data-problem="p1">Problem 1: Axle Load Shift</button></li>
                                        <li><button class="nav-btn" data-problem="p2">Problem 2: 3PH Linkage Forces</button></li>
                                        <li><button class="nav-btn" data-problem="p3">Problem 3: Dynamic Overturning</button></li>
                                    </ul>
                                </nav>
                            </aside>

                            <section id="problem-panel" class="w-full md:w-2/3 lg:w-3/4">
                                
                                <div id="p1-content" class="problem-content active space-y-6">
                                    <div class="bg-white p-6 rounded-lg shadow-md">
                                        <h2 class="text-2xl font-bold text-amber-700 mb-4">Problem 1: Static Load Shift During Draft</h2>
                                        <p class="text-stone-700 mb-4">A 4WD tractor has a total mass <span class="math"><i class="variable">M</i> = 6,000 kg</span> and a wheelbase <span class="math"><i class="variable">L</i> = 3.0 m</span>. The Center of Gravity (CG) is located <span class="math"><i class="variable">L<sub class="sub">r</sub></i> = 1.5 m</span> forward of the rear axle and at a height <span class="math"><i class="variable">h<sub class="sub">CG</sub></i> = 1.0 m</span>.</p>
                                        <p class="text-stone-700 mb-4">The tractor pulls a trailed implement, exerting a Draft Force <span class="math"><i class="variable">F<sub class="sub">D</sub></i> = 40 kN</span> at a drawbar height <span class="math"><i class="variable">h<sub class="sub">D</sub></i> = 0.5 m</span>. (Assume <span class="math"><i class="variable">g</i> = 9.81 m/s<sup>2</sup></span>).</p>
                                        <h3 class="text-lg font-semibold text-stone-800">Questions:</h3>
                                        <ol class="list-decimal list-outside pl-6 text-stone-700">
                                            <li>Calculate the Normal Forces on the front (<i class="variable">N<sub class="sub">f</sub></i>) and rear (<i class="variable">N<sub class="sub">r</sub></i>) axles at rest.</li>
                                            <li>Calculate the new Normal Forces (<i class="variable">N<sub class="sub">f</sub>'</i> and <i class="variable">N<sub class="sub">r</sub>'</i>) while pulling the implement.</li>
                                        </ol>
                                    </div>

                                    <div class="fbd-diagram">
                                        <div class="fbd-box">Tractor (CG)</div>
                                        <div class="fbd-arrow" style="left: 20%; bottom: 10px;">↑ <i class="variable">N<sub class="sub">f</sub>'</i></div>
                                        <div class="fbd-arrow" style="left: 75%; bottom: 10px;">↑ <i class="variable">N<sub class="sub">r</sub>'</i></div>
                                        <div class="fbd-arrow" style="left: 50%; top: 10px; transform: translateX(-50%);">↓ <i class="variable">W</i></div>
                                        <div class="fbd-arrow" style="right: 10%; top: 60%;">← <i class="variable">F<sub class="sub">D</sub></i></div>
                                    </div>

                                    <div class="space-y-2 accordion-container">
                                        <div class="accordion-item">
                                            <button class="accordion-toggle">
                                                <span>Step 1: Calculate Total Weight (<i>W</i>)</span>
                                                <span class="icon"></span>
                                            </button>
                                            <div class="accordion-content">
                                                <p class="text-stone-700">First, convert the tractor's mass to weight (a force).</p>
                                                <p class="mt-2"><span class="math"><i class="variable">W</i> = <i class="variable">M</i> × <i class="variable">g</i></span></p>
                                                <p class="mt-2"><span class="math"><i class="variable">W</i> = 6,000 kg × 9.81 m/s<sup>2</sup> = 58,860 N</span></p>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <button class="accordion-toggle">
                                                <span>Step 2: Analysis at Rest (Question 1)</span>
                                                <span class="icon"></span>
                                            </button>
                                            <div class="accordion-content">
                                                <p class="text-stone-700">To find <i class="variable">N<sub class="sub">f</sub></i>, sum the moments around the rear axle ($R$):</p>
                                                <p class="mt-2"><span class="math">Σ<i class="variable">M<sub class="sub">R</sub></i> = 0</span></p>
                                                <p class="mt-2"><span class="math">(<i class="variable">N<sub class="sub">f</sub></i> × <i class="variable">L</i>) - (<i class="variable">W</i> × <i class="variable">L<sub class="sub">r</sub></i>) = 0</span></p>
                                                <p class="mt-2"><span class="math"><i class="variable">N<sub class="sub">f</sub></i> = (58,860 N × 1.5 m) / 3.0 m = 29,430 N</span></p>
                                                <p class="text-stone-700 mt-4">To find <i class="variable">N<sub class="sub">r</sub></i>, sum the vertical forces:</p>
                                                <p class="mt-2"><span class="math"><i class="variable">N<sub class="sub">r</sub></i> = <i class="variable">W</i> - <i class="variable">N<sub class="sub">f</sub></i> = 58,860 N - 29,430 N = 29,430 N</span></p>
                                                <p class="font-bold text-amber-800 mt-2">Answer 1: $N_f = 29,430 \text{ N}$, $N_r = 29,430 \text{ N}$</p>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <button class="accordion-toggle">
                                                <span>Step 3: Analysis Under Draft Load (Question 2)</span>
                                                <span class="icon"></span>
                                            </button>
                                            <div class="accordion-content">
                                                <p class="text-stone-700">The draft force <i class="variable">F<sub class="sub">D</sub></i> creates a moment that shifts weight. Sum moments around the front axle ($F$) to find <i class="variable">N<sub class="sub">r</sub>'</i>:</p>
                                                <p class="mt-2"><span class="math">Σ<i class="variable">M<sub class="sub">F</sub></i> = 0</span></p>
                                                <p class="mt-2"><span class="math">(<i class="variable">N<sub class="sub">r</sub>'</i> × <i class="variable">L</i>) - (<i class="variable">W</i> × (<i class="variable">L</i> - <i class="variable">L<sub class="sub">r</sub></i>)) - (<i class="variable">F<sub class="sub">D</sub></i> × <i class="variable">h<sub class="sub">D</sub></i>) = 0</span></p>
                                                <p class="mt-2"><span class="math"><i class="variable">N<sub class="sub">r</sub>'</i> = [(58,860 N × 1.5 m) + (40,000 N × 0.5 m)] / 3.0 m</span></p>
                                                <p class="mt-2"><span class="math"><i class="variable">N<sub class="sub">r</sub>'</i> = (88,290 N·m + 20,000 N·m) / 3.0 m = 36,097 N</span></p>
                                                <p class="text-stone-700 mt-4">Sum vertical forces to find <i class="variable">N<sub class="sub">f</sub>'</i>:</p>
                                                <p class="mt-2"><span class="math"><i class="variable">N<sub class="sub">f</sub>'</i> = <i class="variable">W</i> - <i class="variable">N<sub class="sub">r</sub>'</i> = 58,860 N - 36,097 N = 22,763 N</span></p>
                                                <p class="font-bold text-amber-800 mt-2">Answer 2: $N_f' = 22,763 \text{ N}$, $N_r' = 36,097 \text{ N}$</p>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <button class="accordion-toggle">
                                                <span>Conclusion</span>
                                                <span class="icon"></span>
                                            </button>
                                            <div class="accordion-content">
                                                <p class="text-stone-700">The draft load caused <span class="math">6,667 N</span> of weight to transfer from the front axle to the rear axle. This is a critical concept for traction, as it increases the normal force on the primary drive wheels.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="p2-content" class="problem-content space-y-6">
                                    <div class="bg-white p-6 rounded-lg shadow-md">
                                        <h2 class="text-2xl font-bold text-amber-700 mb-4">Problem 2: 3-Point Hitch (3PH) Linkage Forces</h2>
                                        <p class="text-stone-700 mb-4">A tractor pulls a mounted implement, resulting in a net horizontal draft force <span class="math"><i class="variable">F<sub class="sub">D</sub></i> = 45 kN</span>. The vertical distance between the Top Link connection and the Lower Link connection on the implement is <span class="math"><i class="variable">d<sub class="sub">v</sub></i> = 1.0 m</span>.</p>
                                        <p class="text-stone-700 mb-4">For this simplified model, assume both links are horizontal and the net draft force <i class="variable">F<sub class="sub">D</sub></i> acts at the midpoint between the links (0.5 m above the lower link).</p>
                                        <h3 class="text-lg font-semibold text-stone-800">Question:</h3>
                                        <p class="text-stone-700">Calculate the force in the Top Link (<i class="variable">F<sub class="sub">T</sub></i>) and the total force in the Lower Links (<i class="variable">F<sub class="sub">L</sub></i>).</p>
                                    </div>

                                    <div class="fbd-diagram" style="height: 200px;">
                                        <div class="fbd-box" style="top: 50%; left: 20%; padding: 2rem 1rem;">Implement Frame</div>
                                        <div class="fbd-arrow" style="left: 45%; top: 20%;">← <i class="variable">F<sub class="sub">T</sub></i> (Top Link)</div>
                                        <div class="fbd-arrow" style="left: 45%; top: 70%;">← <i class="variable">F<sub class="sub">L</sub></i> (Lower Link)</div>
                                        <div class="fbd-arrow" style="right: 10%; top: 45%; color: #92400e">→ <i class="variable">F<sub class="sub">D</sub></i> (Draft)</div>
                                    </div>

                                    <div class="space-y-2 accordion-container">
                                        <div class="accordion-item">
                                            <button class="accordion-toggle">
                                                <span>Step 1: Horizontal Force Equilibrium</span>
                                                <span class="icon"></span>
                                            </button>
                                            <div class="accordion-content">
                                                <p class="text-stone-700">The sum of the horizontal forces from the links must equal the total draft force $F_D$.</p>
                                                <p class="mt-2"><span class="math">Σ<i class="variable">F<sub class="sub">x</sub></i> = 0</span></p>
                                                <p class="mt-2"><span class="math"><i class="variable">F<sub class="sub">L</sub></i> + <i class="variable">F<sub class="sub">T</sub></i> = <i class="variable">F<sub class="sub">D</sub></i></span></p>
                                                <p class="mt-2"><span class="math"><i class="variable">F<sub class="sub">L</sub></i> + <i class="variable">F<sub class="sub">T</sub></i> = 45,000 N</span> (Equation 1)</p>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <button class="accordion-toggle">
                                                <span>Step 2: Moment Equilibrium (Find <i>F<sub class="sub">T</sub></i>)</span>
                                                <span class="icon"></span>
                                            </button>
                                            <div class="accordion-content">
                                                <p class="text-stone-700">To find <i class="variable">F<sub class="sub">T</sub></i>, sum the moments around the Lower Link connection point ($L$). This makes the moment from <i class="variable">F<sub class="sub">L</sub></i> zero.</p>
                                                <p class="mt-2"><span class="math">Σ<i class="variable">M<sub class="sub">L</sub></i> = 0</span></p>
                                                <p class="text-stone-700 mt-2">The moment from $F_D$ must be balanced by the moment from $F_T$.</p>
                                                <p class="mt-2"><span class="math">(<i class="variable">F<sub class="sub">D</sub></i> × 0.5 m) - (<i class="variable">F<sub class="sub">T</sub></i> × <i class="variable">d<sub class="sub">v</sub></i>) = 0</span></p>
                                                <p class="mt-2"><span class="math">(45,000 N × 0.5 m) = <i class="variable">F<sub class="sub">T</sub></i> × 1.0 m</span></p>
                                                <p class="mt-2"><span class="math">22,500 N·m = <i class="variable">F<sub class="sub">T</sub></i> × 1.0 m</span></p>
                                                <p class="mt-2"><span class="math"><i class="variable">F<sub class="sub">T</sub></i> = 22,500 N</span></p>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <button class="accordion-toggle">
                                                <span>Step 3: Calculate Lower Link Force (<i>F<sub class="sub">L</sub></i>)</span>
                                                <span class="icon"></span>
                                            </button>
                                            <div class="accordion-content">
                                                <p class="text-stone-700">Substitute the value of <i class="variable">F<sub class="sub">T</sub></i> back into Equation 1.</p>
                                                <p class="mt-2"><span class="math"><i class="variable">F<sub class="sub">L</sub></i> + 22,500 N = 45,000 N</span></p>
                                                <p class="mt-2"><span class="math"><i class="variable">F<sub class="sub">L</sub></i> = 45,000 N - 22,500 N = 22,500 N</span></p>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <button class="accordion-toggle">
                                                <span>Conclusion</span>
                                                <span class="icon"></span>
                                            </button>
                                            <div class="accordion-content">
                                                <p class="font-bold text-amber-800">Answer: $F_T = 22.5 \text{ kN}$ and $F_L = 22.5 \text{ kN}$</p>
                                                <p class="text-stone-700 mt-2">In this simplified model, the draft load is shared equally. In a real system, the Top Link is often in compression, which this model can show if the $F_D$ acts above the Top Link, creating a moment in the opposite direction.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="p3-content" class="problem-content space-y-6">
                                    <div class="bg-white p-6 rounded-lg shadow-md">
                                        <h2 class="text-2xl font-bold text-amber-700 mb-4">Problem 3: Dynamic Overturning Stability</h2>
                                        <p class="text-stone-700 mb-4">Using the tractor specifications from Problem 1: <span class="math"><i class="variable">M</i> = 6,000 kg</span>, <span class="math"><i class="variable">L<sub class="sub">r</sub></i> = 1.5 m</span>, <span class="math"><i class="variable">h<sub class="sub">CG</sub></i> = 1.0 m</span>, and <span class="math"><i class="variable">W</i> = 58,860 N</span>. Assume no implement is attached.</p>
                                        <h3 class="text-lg font-semibold text-stone-800">Question:</h3>
                                        <p class="text-stone-700">Calculate the maximum possible forward acceleration ($a<sub class="sub">max</sub>$) the tractor can achieve before the front wheels lift off the ground (Condition for Rearward Overturning). Ignore power limits and wheel slip.</p>
                                    </div>

                                    <div class="fbd-diagram" style="height: 180px;">
                                        <div class="fbd-box">Tractor (CG)</div>
                                        <div class="fbd-arrow" style="left: 20%; bottom: 10px; color: #9ca3af;">↑ <i class="variable">N<sub class="sub">f</sub></i> = 0</div>
                                        <div class="fbd-arrow" style="left: 75%; bottom: 10px;">↑ <i class="variable">N<sub class="sub">r</sub></i></div>
                                        <div class="fbd-arrow" style="left: 50%; top: 10px; transform: translateX(-50%);">↓ <i class="variable">W</i></div>
                                        <div class="fbd-arrow" style="left: 50%; top: 40%; transform: translateX(-50%); color: #ef4444; font-weight: 700;">← <i class="variable">F<sub class="sub">inertia</sub></i></div>
                                    </div>

                                    <div class="space-y-2 accordion-container">
                                        <div class="accordion-item">
                                            <button class="accordion-toggle">
                                                <span>Step 1: Define the Tipping Condition</span>
                                                <span class="icon"></span>
                                            </button>
                                            <div class="accordion-content">
                                                <p class="text-stone-700">Rearward overturning begins when the front wheels lift off the ground. At this exact moment, the Normal Force on the front axle is zero (<span class="math"><i class="variable">N<sub class="sub">f</sub></i> = 0</span>).</p>
                                                <p class="text-stone-700 mt-2">The tractor pivots around the tipping axis, which is the center of the rear axle ($R$).</p>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <button class="accordion-toggle">
                                                <span>Step 2: Dynamic Moment Equilibrium</span>
                                                <span class="icon"></span>
                                            </button>
                                            <div class="accordion-content">
                                                <p class="text-stone-700">At the point of tipping, the moments around the rear axle ($R$) are balanced. The "Restoring Moment" (from $W$) is equal to the "Overturning Moment" (from $F_{inertia}$).</p>
                                                <p class="mt-2"><span class="math">Σ<i class="variable">M<sub class="sub">R</sub></i> = 0</span></p>
                                                <p class="mt-2"><span class="math">(<i class="variable">W</i> × <i class="variable">L<sub class="sub">r</sub></i>) - (<i class="variable">F<sub class="sub">inertia</sub></i> × <i class="variable">h<sub class="sub">CG</sub></i>) = 0</span></p>
                                                <p class="mt-2"><span class="math"><i class="variable">W</i> × <i class="variable">L<sub class="sub">r</sub></i> = <i class="variable">F<sub class="sub">inertia</sub></i> × <i class="variable">h<sub class="sub">CG</sub></i></span></p>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <button class="accordion-toggle">
                                                <span>Step 3: Substitute Inertial Force</span>
                                                <span class="icon"></span>
                                            </button>
                                            <div class="accordion-content">
                                                <p class="text-stone-700">We know that $F_{inertia} = M \cdot a$. We are looking for $a_{max}$.</p>
                                                <p class="mt-2"><span class="math"><i class="variable">W</i> × <i class="variable">L<sub class="sub">r</sub></i> = (<i class="variable">M</i> × <i class="variable">a<sub class="sub">max</sub></i>) × <i class="variable">h<sub class="sub">CG</sub></i></span></p>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <button class="accordion-toggle">
                                                <span>Step 4: Solve for $a<sub class="sub">max</sub>$</span>
                                                <span class="icon"></span>
                                            </button>
                                            <div class="accordion-content">
                                                <p class="text-stone-700">Rearrange the equation to solve for $a_{max}$.</p>
                                                <p class="mt-2"><span class="math"><i class="variable">a<sub class="sub">max</sub></i> = (<i class="variable">W</i> × <i class="variable">L<sub class="sub">r</sub></i>) / (<i class="variable">M</i> × <i class="variable">h<sub class="sub">CG</sub></i>)</span></p>
                                                <p class="text-stone-700 mt-2">Since $W = M \cdot g$, the mass $M$ cancels out:</p>
                                                <p class="mt-2"><span class="math"><i class="variable">a<sub class="sub">max</sub></i> = (<i class="variable">M</i>·<i class="variable">g</i> × <i class="variable">L<sub class="sub">r</sub></i>) / (<i class="variable">M</i> × <i class="variable">h<sub class="sub">CG</sub></i>) = <i class="variable">g</i> × (<i class="variable">L<sub class="sub">r</sub></i> / <i class="variable">h<sub class="sub">CG</sub></i>)</span></p>
                                                <p class="text-stone-700 mt-2">Now, plug in the values:</p>
                                                <p class="mt-2"><span class="math"><i class="variable">a<sub class="sub">max</sub></i> = 9.81 m/s<sup>2</sup> × (1.5 m / 1.0 m)</span></p>
                                                <p class="mt-2"><span class="math"><i class="variable">a<sub class="sub">max</sub></i> = 14.715 m/s<sup>2</sup></span></p>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <button class="accordion-toggle">
                                                <span>Conclusion</span>
                                                <span class="icon"></span>
                                            </button>
                                            <div class="accordion-content">
                                                <p class="font-bold text-amber-800">Answer: The maximum theoretical acceleration is $14.715 \text{ m/s}^2$.</p>
                                                <p class="text-stone-700 mt-2">The ratio $L_r / h_{CG}$ is known as the **Static Stability Factor**. This calculation shows that the tractor's stability against rearward overturning is purely dependent on its geometry ($L_r$ and $h_{CG}$) and gravity.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </section>
                        </div>
                    </div>
                </div>

            </section>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- 1. Main Navigation Logic (Overview, Systems, Implements, etc.) ---
            const navButtons = document.querySelectorAll('.nav-btn[data-content]');
            const contentSections = document.querySelectorAll('.content-section');

            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const contentId = button.dataset.content;

                    navButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    contentSections.forEach(section => {
                        if (section.id === `${contentId}-content`) {
                            section.classList.add('active');
                        } else {
                            section.classList.remove('active');
                        }
                    });
                });
            });

            
            // --- 2. Implement Tab Logic (Mounted, Semi-Mounted, Trailed) ---
            const implementTabsContainer = document.getElementById('implement-tabs');
            if (implementTabsContainer) {
                const tabButtons = implementTabsContainer.querySelectorAll('.tab-btn');
                const tabContents = implementTabsContainer.parentElement.querySelectorAll('.tab-content');

                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const tabId = button.dataset.tab;

                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');

                        tabContents.forEach(content => {
                            if (content.id === tabId) {
                                content.classList.add('active');
                            } else {
                                content.classList.remove('active');
                            }
                        });
                    });
                });
            }

            
            // --- 3. Chart.js Initialization ---
            const timeCtx = document.getElementById('timeChart');
            if (timeCtx) {
                new Chart(timeCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Part 1: Foundation & Review', 'Part 2: Classification & Dynamics', 'Part 3: Conclusion & Application'],
                        datasets: [{
                            label: 'Session Time (min)',
                            data: [75, 75, 15],
                            backgroundColor: [
                                '#f59e0b', 
                                '#d97706', 
                                '#b45309'  
                            ],
                            borderColor: '#f5f5f4',
                            borderWidth: 4,
                            hoverOffset: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                        family: "'Inter', sans-serif",
                                        size: 12
                                    },
                                    color: '#44403c'
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.raw} minutes`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // --- 4. Problem Set Navigation Logic (p1, p2, p3) ---
            const problemNavContainer = document.getElementById('problem-nav');
            const problemContentSections = document.querySelectorAll('.problem-content');

            if (problemNavContainer) {
                const navButtons = problemNavContainer.querySelectorAll('.nav-btn');

                navButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const problemId = button.dataset.problem;
                        
                        navButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');

                        problemContentSections.forEach(section => {
                            if (section.id === `${problemId}-content`) {
                                section.classList.add('active');
                            } else {
                                section.classList.remove('active');
                            }
                        });
                    });
                });
            }


            // --- 5. Accordion Logic for Problem Steps (Step 1, Step 2, etc.) ---
            const problemPanel = document.getElementById('problem-panel');

            if (problemPanel) {
                problemPanel.addEventListener('click', (e) => {
                    const targetToggle = e.target.closest('.accordion-toggle');
                    if (!targetToggle) return;

                    const content = targetToggle.nextElementSibling;
                    
                    targetToggle.classList.toggle('active');
                    
                    // Toggle the 'active' class on the *content* to manage visibility via CSS
                    content.classList.toggle('active');
                });
            }

        });

        // --- Utility functions for iframe (Optional: only needed if running inside an iframe) ---
        function sendHeight() {
          const height = document.body.scrollHeight;
           parent.postMessage({ height: height }, "*");
         }
         window.onload = sendHeight;
         window.onresize = sendHeight;
    </script>
</body>
</html>
